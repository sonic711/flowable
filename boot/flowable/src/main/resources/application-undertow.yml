server.undertow.accesslog.enabled: false

## Accordning to Spring boot 3.2.1
## ref: https://github.com/spring-projects/spring-boot/blob/v3.2.1/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java
server:
  undertow:
    ## http post body 大小，預設為 -1 ，即不限制
    max-http-post-size: -1
    ## 以下的設定會影響buffer,這些buffer會用於服務器連接的IO操作
    ## 如果每次需要 ByteBuffer 的時候都去申請，對於堆記憶體的 ByteBuffer 需要走 JVM 記憶體分配流程（TLAB -> 堆），對於直接記憶體則需要走系統調用，這樣效率是很低下的。
    ## 所以，一般都會引入記憶體池。在這裡就是 `BufferPool`。
    ## 目前，UnderTow 中只有一種 `DefaultByteBufferPool`，其他的實現目前沒有用。
    ## 這個 DefaultByteBufferPool 相對於 netty 的 ByteBufArena 來說，非常簡單，類似於 JVM TLAB 的機制
    ## 對於 bufferSize，最好和你系統的 TCP Socket Buffer 設定一樣
    ## `/proc/sys/net/ipv4/tcp_rmem` (對於讀取)
    ## `/proc/sys/net/ipv4/tcp_wmem` (對於寫入)
    ## 在記憶體大於 128 MB 時，bufferSize 為 16 KB 減去 20 字節，這 20 字節用於協議頭
    buffer-size: 16364
    ## 是否分配的直接記憶體(NIO直接分配的堆外記憶體)，這裡開啟，所以java啟動參數需要設定下直接記憶體大小，減少不必要的GC
    ## 在記憶體大於 128 MB 時，預設就是使用直接記憶體的
    direct-buffers: true
    ## 是否在啟動時創建 filter，預設為 true，不用修改
    eager-filter-init: true
    ## 限制路徑參數數量，預設為 1000
    max-parameters: 1000
    ## 限制 http header 數量，預設為 200
    max-headers: 200
    ## 限制 http header 中 cookies 的鍵值對數量，預設為 200
    max-cookies: 200
    ## 是否允許 / 與 %2F 轉換。/ 是 URL 保留字,除非你的應用明確需要，否則不要開啟，預設為 false
    #    decoded-slash: false
    ## 是否允許 URL 解碼，預設為 true，除了 %2F 其他的都會處理
    decode-url: true
    ## url 編碼，預設是 utf-8
    url-charset: utf-8
    ## 回應的 http header 是否會加上 'Connection: keep-alive'，預設為 true
    always-set-keep-alive: true
    ## 請求超時，預設是不超時，我們的微服務因為可能有長時間的定時任務，所以不做服務端超時，都用客戶端超時，所以我們保持這個預設設定
    no-request-timeout: -1
    ## 是否在跳轉的時候保持 path，預設是關閉的，一般不用設定
    preserve-path-on-forward: false
    threads:
      ## Number of I/O threads to create for the worker. The default is derived from
      ## the number of available processors.
      io: 4
      ## Number of worker threads. The default is 8 times the number of I/O threads.
      worker: 128
    options:
      # spring boot 沒有抽像的 xnio 相關設定在這裡設定，對應 org.xnio.Options 類
      socket:
        SSL_ENABLED: false
      # spring boot 沒有抽像的 undertow 相關設定在這裡設定，對應 io.undertow.UndertowOptions 類
      server:
        ALLOW_UNKNOWN_PROTOCOLS: false
        record-request-start-time: true
    # access log相關設定
    accesslog:
      # 是否開啟
      #enabled: true
      # 存放目錄，預設為 logs
      dir: ${LOG_FILE_PATH:c:/logs/camunda/}/undertow
      # 格式，各種變數後面會詳細說明
      pattern: '{
                  "transportProtocol":"%{TRANSPORT_PROTOCOL}",
                  "scheme":"%{SCHEME}",
                  "protocol":"%{PROTOCOL}",
                  "method":"%{METHOD}",
                  "reqHeaderUserAgent":"%{i,User-Agent}",
                  "reqHeaderUserId":"%{i,uid}",
                  "traceId":"%{i,X-B3-TraceId}",
                  "spanId":"%{i,X-B3-SpanId}",
                  "queryString": "%q",
                  "uri": "%U",
                  "thread": "%I",
                  "hostPort": "%{HOST_AND_PORT}",
                  "localIp": "%A",
                  "localPort": "%p",
                  "localServerName": "%v",
                  "remoteIp": "%a",
                  "bytesSent": "%b",
                  "time":"%{time,yyyy-MM-dd HH:mm:ss.S}",
                  "status":"%s",
                  "reason":"%{RESPONSE_REASON_PHRASE}",
                  "timeUsed":"%Dms"
                }'
      # 文件前綴，預設為 access_log
      prefix: access.
      # 文件後綴，預設為 log
      suffix: log
      # 是否另起日誌文件寫 access log，預設為 true
      # 目前只能按照日期進行 rotate，一天一個日誌文件
      rotate: true
